<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHONGMU FINAL v9.3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;900&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; color: #1e293b; margin: 0; }
        .tab-content { display: none; min-height: 100vh; padding-bottom: 120px; }
        .tab-content.active { display: block; animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .nav-active { color: #ef4444 !important; font-weight: 900; }
        .admin-only { display: none !important; }
        .is-admin .admin-only { display: block !important; }
        input, select, textarea { font-size: 16px !important; }
    </style>
</head>
<body>
    <div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative overflow-x-hidden">
        
        <header class="px-6 pt-8 pb-4 flex justify-between items-end sticky top-0 bg-white/90 backdrop-blur-md z-40 border-b border-slate-50">
            <div>
                <h1 id="groupNameDisplay" onclick="editGroupName()" class="text-2xl font-black text-slate-900 cursor-pointer">ìš°ë¦¬ ëª¨ì„ íšŒ</h1>
            </div>
            <div class="text-right">
                <p class="text-[9px] font-bold text-slate-300 mb-2 uppercase italic tracking-tighter">CHONGMU v9.3</p>
                <div class="flex gap-2">
                    <button onclick="openModal('memberModal')" class="text-[10px] font-bold bg-blue-50 text-blue-600 px-3 py-1.5 rounded-full">ê°€ì…ì‹ ì²­</button>
                    <button onclick="toggleAdmin()" id="adminBtn" class="text-[10px] font-bold bg-slate-900 text-white px-3 py-1.5 rounded-full shadow-lg">ğŸ” ê´€ë¦¬ì</button>
                </div>
            </div>
        </header>

        <main id="homeTab" class="tab-content active px-6 pt-6">
            <div class="bg-slate-900 p-8 rounded-[2.5rem] text-center text-white shadow-2xl mb-8">
                <p class="text-[10px] font-bold opacity-40 mb-2 tracking-widest uppercase italic">Total Balance</p>
                <h2 id="mainBalance" class="text-4xl font-black tracking-tight">0ì›</h2>
            </div>

            <h3 class="font-black text-lg mb-4 px-1">ìµœê·¼ ë‚´ì—­</h3>
            <div id="mainHistory" class="space-y-3 mb-8"></div>

            <div class="bg-red-50 p-6 rounded-[2rem] border border-red-100 relative">
                <h4 class="text-red-600 font-black text-[10px] mb-2 uppercase italic">Notice</h4>
                <button onclick="editNotice()" class="admin-only absolute top-5 right-5 text-[10px] text-slate-400 font-bold underline">ìˆ˜ì •</button>
                <p id="noticeArea" class="text-sm font-bold text-slate-700 leading-relaxed"></p>
            </div>
        </main>

        <main id="memberTab" class="tab-content px-6 pt-6">
            <div id="pendingSection" class="admin-only mb-8">
                <h3 class="text-orange-500 font-black text-sm mb-4 italic flex items-center gap-2">âš ï¸ ìŠ¹ì¸ ëŒ€ê¸° ëª…ë‹¨</h3>
                <div id="pendingList" class="space-y-3"></div>
            </div>
            <h3 class="font-black text-lg mb-6 px-1">íšŒì› ëª©ë¡</h3>
            <div id="memberList" class="space-y-4"></div>
        </main>

        <main id="ledgerTab" class="tab-content px-6 pt-6">
            <div class="admin-only grid grid-cols-2 gap-3 mb-8">
                <button onclick="openLedgerModal('INCOME')" class="bg-blue-600 text-white py-6 rounded-[2rem] font-black shadow-lg">ğŸ’° ìˆ˜ì… ì…ë ¥</button>
                <button onclick="openLedgerModal('EXPENSE')" class="bg-slate-800 text-white py-6 rounded-[2rem] font-black shadow-lg">ğŸ’¸ ì§€ì¶œ ì…ë ¥</button>
            </div>
            <div id="fullHistory" class="space-y-2"></div>
        </main>

        <div id="ledgerModal" class="fixed inset-0 bg-black/80 z-[100] hidden flex items-end">
            <div class="bg-white w-full max-w-md mx-auto rounded-t-[3rem] p-8">
                <h3 id="lTitle" class="text-xl font-black mb-8 text-center uppercase tracking-tighter italic">Entry</h3>
                <div class="space-y-4 mb-8">
                    <input id="lDate" type="date" class="w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none border border-slate-100">
                    <select id="lMember" class="w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none border border-slate-100"></select>
                    
                    <div id="categoryArea" class="space-y-2">
                        <div id="categoryPresets" class="flex gap-2 mb-2"></div>
                        <input id="lCategory" type="text" placeholder="í•­ëª© ì§ì ‘ ì…ë ¥" class="w-full p-4 bg-slate-50 rounded-2xl font-bold outline-none border border-slate-100">
                    </div>

                    <input id="lAmount" type="number" placeholder="ê¸ˆì•¡" class="w-full p-4 bg-slate-50 rounded-2xl text-2xl font-black text-center text-red-600 outline-none border border-slate-100">
                </div>
                <div class="flex gap-2">
                    <button onclick="closeModal('ledgerModal')" class="flex-1 py-5 bg-slate-100 font-bold rounded-2xl">ì·¨ì†Œ</button>
                    <button onclick="saveLedger()" class="flex-[2] py-5 bg-slate-900 text-white font-black rounded-2xl shadow-lg">ê¸°ë¡ ì €ì¥</button>
                </div>
            </div>
        </div>

        <div id="memberModal" class="fixed inset-0 bg-black/80 z-[100] hidden flex items-end">
            <div class="bg-white w-full max-w-md mx-auto rounded-t-[3rem] p-8">
                <h3 class="text-xl font-black mb-6">íšŒì› ê°€ì… ì‹ ì²­</h3>
                <div class="space-y-4">
                    <input id="mName" type="text" placeholder="ì´ë¦„" class="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold">
                    <input id="mPhone" type="tel" placeholder="ì—°ë½ì²˜" class="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold">
                    <button onclick="requestJoin()" class="w-full py-5 bg-blue-600 text-white font-black rounded-2xl shadow-lg mt-4">ì‹ ì²­í•˜ê¸°</button>
                    <button onclick="closeModal('memberModal')" class="w-full py-2 text-slate-400 font-bold">ë‹«ê¸°</button>
                </div>
            </div>
        </div>

        <nav class="fixed bottom-6 left-6 right-6 h-20 bg-white shadow-2xl rounded-[2.5rem] border border-slate-100 flex justify-around items-center px-6 z-40">
            <button onclick="switchTab('home')" id="n-home" class="nav-active flex flex-col items-center gap-1"><span class="text-xl">ğŸ </span><span class="text-[9px] font-black uppercase">Home</span></button>
            <button onclick="switchTab('member')" id="n-member" class="text-slate-300 flex flex-col items-center gap-1"><span class="text-xl">ğŸ‘¥</span><span class="text-[9px] font-black uppercase">Member</span></button>
            <button onclick="switchTab('ledger')" id="n-ledger" class="text-slate-300 flex flex-col items-center gap-1"><span class="text-xl">ğŸ“Š</span><span class="text-[9px] font-black uppercase">Ledger</span></button>
            <button onclick="backupData()" class="text-slate-300 flex flex-col items-center gap-1"><span class="text-xl">ğŸ’¾</span><span class="text-[9px] font-black uppercase">Backup</span></button>
        </nav>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('chongmu_v93_db')) || {
            groupName: "ìš°ë¦¬ ëª¨ì„ íšŒ",
            pw: "1234",
            notice: "ê³µì§€ì‚¬í•­ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.",
            members: [],
            pending: [],
            history: []
        };

        let isAdmin = false, currentMode = 'INCOME';

        function saveData() { localStorage.setItem('chongmu_v93_db', JSON.stringify(db)); render(); }

        function toggleAdmin() {
            const input = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            if(input === db.pw) {
                isAdmin = !isAdmin;
                document.body.classList.toggle('is-admin', isAdmin);
                document.getElementById('adminBtn').innerHTML = isAdmin ? "ğŸ”“ ê´€ë¦¬ì¤‘" : "ğŸ” ê´€ë¦¬ì";
                render();
            }
        }

        function editGroupName() {
            if(!isAdmin) return;
            const name = prompt("ëª¨ì„ íšŒ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.", db.groupName);
            if(name) { db.groupName = name; saveData(); }
        }

        function editNotice() {
            const n = prompt("ìƒˆ ê³µì§€ì‚¬í•­", db.notice);
            if(n) { db.notice = n; saveData(); }
        }

        function openLedgerModal(mode) {
            currentMode = mode;
            document.getElementById('lDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('lMember').innerHTML = '<option value="">íšŒì› ì„ íƒ(ì„ íƒ)</option>' + db.members.map(m => `<option value="${m.name}">${m.name}</option>`).join('');
            
            const presetArea = document.getElementById('categoryPresets');
            if(mode === 'INCOME') {
                presetArea.innerHTML = `
                    <button onclick="setCat('íšŒë¹„')" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-xs font-black">íšŒë¹„</button>
                    <button onclick="setCat('ì°¬ì¡°')" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-xs font-black">ì°¬ì¡°</button>
                `;
            } else {
                presetArea.innerHTML = `<button class="bg-slate-200 text-slate-500 px-4 py-2 rounded-xl text-xs font-black">ìˆ˜ë™ì…ë ¥ ì „ìš©</button>`;
            }
            document.getElementById('lCategory').value = '';
            openModal('ledgerModal');
        }

        function setCat(val) { document.getElementById('lCategory').value = val; }

        function saveLedger() {
            const name = document.getElementById('lMember').value;
            const cat = document.getElementById('lCategory').value;
            const date = document.getElementById('lDate').value;
            let amt = parseInt(document.getElementById('lAmount').value);
            if(!amt || !cat) return;
            if(currentMode === 'EXPENSE') amt = -amt;
            db.history.unshift({ id: Date.now(), name, cat, amt, date });
            if(currentMode === 'INCOME' && name) {
                const m = db.members.find(x => x.name === name);
                if(m) m.totalPaid = (m.totalPaid || 0) + amt;
            }
            saveData(); closeModal('ledgerModal');
        }

        function requestJoin() {
            const name = document.getElementById('mName').value.trim();
            const phone = document.getElementById('mPhone').value.trim();
            if(!name || !phone) return;
            db.pending.push({ id: Date.now(), name, phone, totalPaid: 0 });
            saveData(); closeModal('memberModal');
            alert("ì‹ ì²­ ì™„ë£Œ! ì´ë¬´ ìŠ¹ì¸ ëŒ€ê¸°ì¤‘.");
        }

        function approveMember(id) {
            const idx = db.pending.findIndex(x => x.id === id);
            db.members.push(db.pending[idx]);
            db.pending.splice(idx, 1);
            saveData();
        }

        function sendKakao(name, phone) {
            const msg = `[${db.groupName}]\nì•ˆë…•í•˜ì„¸ìš” ${name}ë‹˜, íšŒë¹„ ë¯¸ë‚© ê±´ í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤!`;
            location.href = `sms:${phone}?body=${encodeURIComponent(msg)}`;
        }

        function render() {
            document.getElementById('groupNameDisplay').innerText = db.groupName;
            document.getElementById('noticeArea').innerText = db.notice;
            const total = db.history.reduce((s, a) => s + a.amt, 0);
            document.getElementById('mainBalance').innerText = total.toLocaleString() + "ì›";

            document.getElementById('pendingList').innerHTML = db.pending.map(m => `
                <div class="p-4 bg-orange-50 rounded-2xl flex justify-between items-center border border-orange-100 mb-2">
                    <div><p class="text-sm font-black">${m.name}</p><p class="text-[10px] font-bold text-orange-400">${m.phone}</p></div>
                    <button onclick="approveMember(${m.id})" class="bg-orange-500 text-white px-4 py-2 rounded-xl text-[10px] font-bold">ìŠ¹ì¸</button>
                </div>`).join('');

            document.getElementById('memberList').innerHTML = db.members.map(m => `
                <div class="p-5 bg-white rounded-3xl border border-slate-50 shadow-sm flex items-center justify-between mb-3">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center font-black text-slate-300">${m.name[0]}</div>
                        <div><h4 class="font-black text-sm">${m.name}</h4><p class="text-[9px] text-slate-300 font-bold">${m.phone}</p></div>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="text-right"><p class="text-[9px] font-bold text-blue-500">PAID</p><p class="font-black text-sm">${(m.totalPaid || 0).toLocaleString()}ì›</p></div>
                        <button onclick="sendKakao('${m.name}', '${m.phone}')" class="admin-only text-lg">ğŸ’¬</button>
                    </div>
                </div>`).join('');

            const hHtml = (d) => d.map(h => `
                <div class="flex justify-between items-center p-4 bg-slate-50 rounded-2xl border border-white mb-2">
                    <div><p class="font-black text-xs">${h.cat}</p><p class="text-[9px] text-slate-400 font-bold italic">${h.date} ${h.name ? 'Â· '+h.name : ''}</p></div>
                    <span class="font-black text-sm ${h.amt > 0 ? 'text-blue-600' : 'text-slate-900'}">${h.amt.toLocaleString()}ì›</span>
                </div>`).join('');
            document.getElementById('mainHistory').innerHTML = hHtml(db.history.slice(0, 5));
            document.getElementById('fullHistory').innerHTML = hHtml(db.history);
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.add('text-slate-300'));
            document.getElementById(id + 'Tab').classList.add('active');
            document.getElementById('n-' + id).classList.remove('text-slate-300', 'nav-active');
            document.getElementById('n-' + id).classList.add('nav-active');
            render();
        }
        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
        function backupData() {
            const blob = new Blob([JSON.stringify(db)], {type: 'application/json'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `chongmu_v93_backup.json`; a.click();
        }
        render();
    </script>
</body>
</html>