<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHONGMU OMNIPOTENT v23.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800;900&display=swap');
        
        /* Î™®Î∞îÏùº Ï§å Î∞©ÏßÄ Î∞è ÌïòÏù¥ÏóîÎìú UI */
        body { font-family: 'Pretendard', sans-serif; background: #000; color: #fff; -webkit-text-size-adjust: none; overflow-x: hidden; }
        input, select, textarea, button { font-size: 16px !important; outline: none; transition: 0.2s; }
        input, select { background: #111 !important; border: 1px solid #222 !important; color: #fff !important; padding: 14px !important; border-radius: 12px !important; }
        input:focus { border-color: #fbbf24 !important; background: #1a1a1a !important; }
        
        .tab-content { display: none; padding-bottom: 140px; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        .admin-only { display: none !important; }
        .is-admin .admin-only { display: block !important; }
        
        .card { background: linear-gradient(145deg, #0f0f0f, #181818); border: 1px solid rgba(255,255,255,0.05); border-radius: 28px; }
        .btn-gold { background: #fbbf24; color: #000; font-weight: 800; border-radius: 16px; }
        .nav-btn.active { color: #fbbf24; transform: translateY(-2px); }
        .settle-badge { font-size: 10px; font-weight: 800; padding: 4px 10px; border-radius: 8px; background: rgba(255,255,255,0.05); color: #888; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen relative">

    <header class="px-6 pt-12 pb-6 flex justify-between items-center sticky top-0 bg-black/80 backdrop-blur-xl z-[100]">
        <div>
            <h1 id="groupName" onclick="editGroupName()" class="text-2xl font-black tracking-tighter cursor-pointer">MASTER LOG</h1>
            <p class="text-[9px] text-amber-500 font-bold tracking-[0.3em] uppercase">Omnipotent v23.0</p>
        </div>
        <button onclick="toggleAdmin()" id="adminBtn" class="bg-white/5 text-[10px] font-black px-5 py-2.5 rounded-full border border-white/10 tracking-widest">üîê LOGIN</button>
    </header>

    <div id="content">
        <main id="homeTab" class="tab-content active px-6 pt-6">
            <div class="card p-10 mb-8 text-center border-amber-500/20 shadow-[0_0_50px_rgba(251,191,36,0.05)]">
                <p class="text-[10px] text-white/30 mb-2 font-bold tracking-[0.4em]">CURRENT BALANCE</p>
                <h2 id="homeBalance" class="text-5xl font-black text-white tracking-tighter">0Ïõê</h2>
            </div>

            <div class="grid grid-cols-3 gap-3 mb-10">
                <div class="card p-4 text-center">
                    <p class="text-[8px] text-white/30 font-bold mb-1 italic">WEEKLY</p>
                    <p id="weekSettle" class="text-xs font-black text-amber-400">+0</p>
                </div>
                <div class="card p-4 text-center border-amber-500/30">
                    <p class="text-[8px] text-white/30 font-bold mb-1 italic">MONTHLY</p>
                    <p id="monthSettle" class="text-xs font-black text-amber-400">+0</p>
                </div>
                <div class="card p-4 text-center">
                    <p class="text-[8px] text-white/30 font-bold mb-1 italic">YEARLY</p>
                    <p id="yearSettle" class="text-xs font-black text-amber-400">+0</p>
                </div>
            </div>
            
            <div class="mb-10">
                <div class="flex justify-between items-center mb-5">
                    <h3 class="text-lg font-black">ÏµúÍ∑º Ìä∏ÎûúÏû≠ÏÖò</h3>
                    <button onclick="switchTab('ledger')" class="text-[10px] text-white/20 font-bold underline">VIEW ALL</button>
                </div>
                <div id="homeHistory" class="space-y-3"></div>
            </div>

            <div class="card p-6 border-l-4 border-l-amber-500">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-[10px] font-black text-amber-500 tracking-widest uppercase">Official Memo</span>
                    <button onclick="editNotice()" class="admin-only text-[10px] text-white/20 underline">Edit</button>
                </div>
                <p id="noticeArea" class="text-sm font-bold text-white/70 leading-relaxed"></p>
            </div>
        </main>

        <main id="memberTab" class="tab-content px-6 pt-8">
            <div class="flex justify-between items-end mb-8">
                <h3 class="text-3xl font-black">MEMBERS</h3>
                <button onclick="openModal('joinModal')" class="bg-white text-black text-[10px] font-black px-4 py-2 rounded-xl">REGISTRATION</button>
            </div>
            
            <div id="pendingArea" class="admin-only mb-12">
                <p class="text-amber-500 text-[10px] font-black mb-4 tracking-[0.2em] px-2">‚óè WAITING LIST</p>
                <div id="pendingList" class="space-y-3"></div>
            </div>
            
            <div id="memberList" class="space-y-5"></div>
        </main>

        <main id="ledgerTab" class="tab-content px-6 pt-8">
            <div class="card p-6 mb-8"><canvas id="mainChart" height="200"></canvas></div>
            
            <div class="admin-only grid grid-cols-2 gap-4 mb-10">
                <button onclick="openLedger('INCOME')" class="btn-gold py-6 shadow-xl shadow-amber-500/10">ÏàòÏûÖ Í∏∞Î°ù</button>
                <button onclick="openLedger('EXPENSE')" class="bg-white/10 text-white py-6 rounded-2xl font-black border border-white/5">ÏßÄÏ∂ú Í∏∞Î°ù</button>
            </div>
            
            <div id="fullHistory" class="space-y-3"></div>
        </main>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 max-w-md mx-auto h-24 bg-black/90 backdrop-blur-2xl border-t border-white/5 flex justify-around items-center px-10 z-[100]">
        <button onclick="switchTab('home')" id="btn-home" class="nav-btn active flex flex-col items-center gap-1.5"><span class="text-2xl">üè†</span><span class="text-[9px] font-black">HOME</span></button>
        <button onclick="switchTab('member')" id="btn-member" class="nav-btn flex flex-col items-center gap-1.5 text-white/20"><span class="text-2xl">üë•</span><span class="text-[9px] font-black">MEMBER</span></button>
        <button onclick="switchTab('ledger')" id="btn-ledger" class="nav-btn flex flex-col items-center gap-1.5 text-white/20"><span class="text-2xl">üìä</span><span class="text-[9px] font-black">LEDGER</span></button>
        <button onclick="exportData()" class="flex flex-col items-center gap-1.5 text-white/20"><span class="text-2xl">üíæ</span><span class="text-[9px] font-black">BACKUP</span></button>
    </nav>

    <div id="editMemberModal" class="fixed inset-0 bg-black/95 z-[200] hidden flex items-end">
        <div class="w-full p-10 max-h-[90vh] overflow-y-auto bg-[#0a0a0a] rounded-t-[3rem] border-t border-white/10 shadow-[0_-20px_50px_rgba(0,0,0,1)]">
            <div class="flex justify-between items-center mb-10">
                <h3 class="text-xl font-black text-white">PROFILE MASTER</h3>
                <button onclick="sendSmsFromModal()" class="bg-green-600 text-white px-5 py-2.5 rounded-2xl text-[10px] font-black shadow-lg">üí¨ ÎØ∏ÎÇ© ÎèÖÏ¥â</button>
            </div>
            
            <div class="space-y-6">
                <div class="flex justify-center mb-8">
                    <div class="relative">
                        <img id="emPhotoPrev" class="w-32 h-32 rounded-[2.5rem] object-cover border-2 border-white/5 shadow-2xl">
                        <input type="file" id="emPhotoFile" class="hidden" accept="image/*" onchange="previewImage(this, 'emPhotoPrev')">
                        <button onclick="document.getElementById('emPhotoFile').click()" class="absolute -bottom-2 -right-2 btn-gold p-3 rounded-2xl shadow-xl">üì∏</button>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <input id="emName" type="text" placeholder="Ïù¥Î¶Ñ">
                    <input id="emPhone" type="tel" placeholder="Ïó∞ÎùΩÏ≤ò">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="text-[10px] text-white/30 ml-1 mb-1 block">ÏÉùÎÖÑÏõîÏùº</label><input id="emBirth" type="date"></div>
                    <div><label class="text-[10px] text-white/30 ml-1 mb-1 block">ÌÇ§ (cm)</label><input id="emHeight" type="number"></div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div><label class="text-[10px] text-white/30 ml-1 mb-1 block">Ïã†Î∞ú (mm)</label><input id="emShoe" type="number"></div>
                    <div><label class="text-[10px] text-white/30 ml-1 mb-1 block">Ïò∑ ÏÇ¨Ïù¥Ï¶à</label><input id="emCloth" type="text"></div>
                </div>
                <div><label class="text-[10px] text-white/30 ml-1 mb-1 block">ÎàÑÏ†Å ÎÇ©Î∂ÄÏï°</label><input id="emPaid" type="number" class="!text-amber-500 font-black text-xl"></div>
            </div>

            <div class="flex gap-4 mt-12 pb-10">
                <button onclick="deleteMember()" class="flex-1 py-5 bg-red-900/20 text-red-500 font-bold rounded-2xl border border-red-500/20">ÏòÅÍµ¨ Ï†úÎ™Ö</button>
                <button onclick="saveMemberEdit()" class="flex-[2] py-5 btn-gold shadow-2xl">Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏</button>
            </div>
        </div>
    </div>

    <div id="ledgerModal" class="fixed inset-0 bg-black/95 z-[200] hidden flex items-end">
        <div class="w-full p-10 bg-[#0a0a0a] rounded-t-[3rem] border-t border-white/10">
            <h3 class="text-center font-black text-amber-500 mb-10 uppercase tracking-[0.4em] italic">Transaction</h3>
            <div class="space-y-4 mb-10">
                <input id="lDate" type="date">
                <select id="lMember"></select>
                <div id="catPresets" class="flex gap-2"></div>
                <input id="lCategory" type="text" placeholder="ÏÉÅÏÑ∏ ÎÇ¥Ïó≠">
                <input id="lAmount" type="number" placeholder="0" class="text-5xl font-black text-center border-none !bg-transparent text-white">
            </div>
            <div class="flex gap-4" id="ledgerBtnArea"></div>
        </div>
    </div>

    <div id="joinModal" class="fixed inset-0 bg-black/95 z-[200] hidden flex items-end">
        <div class="w-full p-10 max-h-[95vh] overflow-y-auto bg-[#0a0a0a] rounded-t-[3rem] border-t border-white/10">
            <h3 class="text-2xl font-black mb-10 text-center">NEW MEMBER</h3>
            <div class="space-y-5">
                <div class="flex flex-col items-center mb-8">
                    <img id="mPhotoPrev" src="https://via.placeholder.com/150" class="w-24 h-24 rounded-[2rem] object-cover border border-white/10 shadow-2xl mb-4">
                    <input type="file" id="mPhotoFile" class="hidden" onchange="previewImage(this, 'mPhotoPrev')">
                    <button onclick="document.getElementById('mPhotoFile').click()" class="text-xs font-black text-amber-500 underline underline-offset-4">ÏÇ¨ÏßÑ Ï¥¨ÏòÅ Î∞è ÏÑ†ÌÉù</button>
                </div>
                <input id="mName" type="text" placeholder="ÏÑ±Ìï® (Ïã§Î™Ö)">
                <input id="mPhone" type="tel" placeholder="Ïó∞ÎùΩÏ≤ò">
                <div class="grid grid-cols-2 gap-3">
                    <input id="mBirth" type="date">
                    <input id="mHeight" type="number" placeholder="ÌÇ§(cm)">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <input id="mShoe" type="number" placeholder="Ïã†Î∞ú(mm)">
                    <input id="mCloth" type="text" placeholder="Ïò∑ ÏÇ¨Ïù¥Ï¶à">
                </div>
            </div>
            <button onclick="submitJoin()" class="w-full py-6 btn-gold shadow-2xl mt-12">Í∞ÄÏûÖ Ïã†Ï≤≠ ÏôÑÎ£å</button>
            <button onclick="closeModal('joinModal')" class="w-full py-5 text-white/20 font-bold mt-2">CLOSE</button>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('CHONGMU_OMNI_V23')) || {
            groupName: "TOP ELITE", notice: "Í¥ÄÎ¶¨Ïûê Î™®ÎìúÏóêÏÑú Ï£ºÏöî Í≥µÏßÄÎ•º ÏûëÏÑ±ÌïòÏã≠ÏãúÏò§.", pw: "1234",
            members: [], pending: [], history: []
        };
        let isAdmin = false, activeMode = 'INCOME', chart = null, currentEditId = null, currentMemberId = null, tempPhoto = "";

        const sync = () => { localStorage.setItem('CHONGMU_OMNI_V23', JSON.stringify(db)); render(); };

        const toggleAdmin = () => {
            const p = prompt("ACCESS CODE");
            if(p === db.pw) {
                isAdmin = !isAdmin;
                document.body.classList.toggle('is-admin', isAdmin);
                document.getElementById('adminBtn').innerText = isAdmin ? "üîì UNLOCKED" : "üîê LOGIN";
                render();
            }
        };

        const editGroupName = () => { if(isAdmin) { const n = prompt("Î™®ÏûÑÎ™Ö", db.groupName); if(n) { db.groupName = n; sync(); } } };
        const editNotice = () => { if(isAdmin) { const n = prompt("Í≥µÏßÄÏÇ¨Ìï≠", db.notice); if(n) { db.notice = n; sync(); } } };

        const previewImage = (input, prevId) => {
            const reader = new FileReader();
            reader.onload = (e) => { document.getElementById(prevId).src = e.target.result; tempPhoto = e.target.result; };
            reader.readAsDataURL(input.files[0]);
        };

        // [Í≤∞ÏÇ∞ ÏóîÏßÑ] Ï£ºÍ∞Ñ/ÏõîÍ∞Ñ/Ïó∞Í∞Ñ Í≥ÑÏÇ∞
        const getSettlement = () => {
            const now = new Date();
            const oneWeek = 7 * 24 * 60 * 60 * 1000;
            const weekStart = new Date(now - oneWeek);
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            const yearStart = new Date(now.getFullYear(), 0, 1);

            const calc = (start) => db.history.filter(h => new Date(h.date) >= start).reduce((s, a) => s + a.amt, 0);

            document.getElementById('weekSettle').innerText = (calc(weekStart) >= 0 ? '+' : '') + calc(weekStart).toLocaleString();
            document.getElementById('monthSettle').innerText = (calc(monthStart) >= 0 ? '+' : '') + calc(monthStart).toLocaleString();
            document.getElementById('yearSettle').innerText = (calc(yearStart) >= 0 ? '+' : '') + calc(yearStart).toLocaleString();
        };

        const openEditMember = (id) => {
            if(!isAdmin) return;
            currentMemberId = id;
            const m = db.members.find(x => x.id === id);
            document.getElementById('emName').value = m.name;
            document.getElementById('emPhone').value = m.phone;
            document.getElementById('emBirth').value = m.birth || "";
            document.getElementById('emHeight').value = m.height || "";
            document.getElementById('emShoe').value = m.shoe || "";
            document.getElementById('emCloth').value = m.cloth || "";
            document.getElementById('emPaid').value = m.totalPaid || 0;
            document.getElementById('emPhotoPrev').src = m.photo || "https://via.placeholder.com/150";
            tempPhoto = m.photo || "";
            openModal('editMemberModal');
        };

        const saveMemberEdit = () => {
            const m = db.members.find(x => x.id === currentMemberId);
            if(m) {
                Object.assign(m, { name: document.getElementById('emName').value, phone: document.getElementById('emPhone').value, birth: document.getElementById('emBirth').value, height: document.getElementById('emHeight').value, shoe: document.getElementById('emShoe').value, cloth: document.getElementById('emCloth').value, totalPaid: parseInt(document.getElementById('emPaid').value || 0), photo: tempPhoto });
                sync(); closeModal('editMemberModal');
            }
        };

        const deleteMember = () => {
            if(confirm("Ïù¥ ÌöåÏõêÏùÑ ÏòÅÍµ¨ ÏÇ≠Ï†ú(Ï†úÎ™Ö)ÌïòÏãúÍ≤†ÏäµÎãàÍπå? Í¥ÄÎ†® Ïû•Î∂Ä Í∏∞Î°ùÏùÄ Ïú†ÏßÄÎêòÏßÄÎßå Î™ÖÎ∂ÄÏóêÏÑúÎäî Ï¶âÏãú ÏÇ≠Ï†úÎê©ÎãàÎã§.")) {
                db.members = db.members.filter(x => x.id !== currentMemberId);
                sync(); closeModal('editMemberModal');
            }
        };

        const sendSmsFromModal = () => {
            const m = db.members.find(x => x.id === currentMemberId);
            const msg = `[${db.groupName}] ÏïàÎÖïÌïòÏÑ∏Ïöî Ï¥ùÎ¨¥ÏûÖÎãàÎã§. ${m.name}Îãò, ÌöåÎπÑ ÎØ∏ÎÇ© Í±¥Ïóê ÎåÄÌï¥ ÌôïÏù∏ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§. (ÌòÑÏû¨ ÎàÑÏ†Å ÎÇ©Î∂ÄÏï°: ${m.totalPaid.toLocaleString()}Ïõê)`;
            location.href = `sms:${m.phone}?body=${encodeURIComponent(msg)}`;
        };

        const openLedger = (mode, editId = null) => {
            activeMode = mode; currentEditId = editId;
            const mSelect = document.getElementById('lMember');
            mSelect.innerHTML = '<option value="">ÎØ∏ÏßÄÏ†ï</option>' + db.members.map(m => `<option value="${m.name}">${m.name}</option>`).join('');
            const presets = document.getElementById('catPresets');
            const btnArea = document.getElementById('ledgerBtnArea');

            if(editId) {
                const h = db.history.find(x => x.id === editId);
                document.getElementById('lDate').value = h.date;
                mSelect.value = h.name || "";
                document.getElementById('lCategory').value = h.cat;
                document.getElementById('lAmount').value = Math.abs(h.amt);
                btnArea.innerHTML = `<button onclick="deleteRecord()" class="flex-1 py-5 bg-red-900/30 text-red-500 font-bold rounded-2xl">DELETE</button><button onclick="saveRecord()" class="flex-[2] btn-gold py-5">UPDATE</button>`;
            } else {
                document.getElementById('lDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('lCategory').value = ''; document.getElementById('lAmount').value = '';
                btnArea.innerHTML = `<button onclick="closeModal('ledgerModal')" class="flex-1 py-5 bg-white/5 font-bold rounded-2xl text-white/20">CANCEL</button><button onclick="saveRecord()" class="flex-[2] btn-gold py-5 shadow-2xl">SAVE</button>`;
            }
            presets.innerHTML = mode === 'INCOME' ? `<button onclick="setCat('Ï†ïÍ∏∞ÌöåÎπÑ')" class="bg-amber-500 text-black px-4 py-2 rounded-xl text-[10px] font-black">#Ï†ïÍ∏∞ÌöåÎπÑ</button><button onclick="setCat('Ï∞¨Ï°∞Í∏à')" class="bg-amber-500 text-black px-4 py-2 rounded-xl text-[10px] font-black">#Ï∞¨Ï°∞Í∏à</button>` : '';
            openModal('ledgerModal');
        };

        const setCat = (v) => { document.getElementById('lCategory').value = v; };

        const saveRecord = () => {
            let amt = parseInt(document.getElementById('lAmount').value);
            const cat = document.getElementById('lCategory').value, date = document.getElementById('lDate').value, name = document.getElementById('lMember').value;
            if(!cat || isNaN(amt)) return;
            amt = (activeMode === 'EXPENSE') ? -Math.abs(amt) : Math.abs(amt);
            if(currentEditId) { const h = db.history.find(x => x.id === currentEditId); Object.assign(h, { date, cat, amt, name }); }
            else { db.history.unshift({ id: Date.now(), name, cat, amt, date }); if(activeMode === 'INCOME' && name) { const m = db.members.find(x => x.name === name); if(m) m.totalPaid = (m.totalPaid || 0) + amt; } }
            sync(); closeModal('ledgerModal');
        };

        const deleteRecord = () => { if(confirm("Ïù¥ ÎÇ¥Ïó≠ÏùÑ ÏòÅÍµ¨ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) { db.history = db.history.filter(x => x.id !== currentEditId); sync(); closeModal('ledgerModal'); } };

        const render = () => {
            document.getElementById('groupName').innerText = db.groupName;
            document.getElementById('noticeArea').innerText = db.notice;
            const balance = db.history.reduce((s, a) => s + a.amt, 0);
            document.getElementById('homeBalance').innerText = balance.toLocaleString() + "Ïõê";
            getSettlement();

            document.getElementById('pendingList').innerHTML = db.pending.map(m => `
                <div class="card p-4 flex justify-between items-center border-amber-500/20">
                    <div class="flex items-center gap-4"><img src="${m.photo || 'https://via.placeholder.com/50'}" class="w-12 h-12 rounded-[1rem] object-cover"><div><p class="text-sm font-black">${m.name}</p><p class="text-[9px] text-white/30">${m.phone}</p></div></div>
                    <button onclick="approve(${m.id})" class="btn-gold px-5 py-2.5 rounded-xl text-[10px] font-black italic">CONFIRM</button>
                </div>`).join('');

            document.getElementById('memberList').innerHTML = db.members.map(m => `
                <div onclick="openEditMember(${m.id})" class="card p-6 shadow-2xl transition-transform active:scale-[0.98]">
                    <div class="flex justify-between items-start mb-6">
                        <div class="flex items-center gap-5">
                            <img src="${m.photo || 'https://via.placeholder.com/150'}" class="w-20 h-20 rounded-[1.5rem] object-cover border border-white/5 shadow-2xl">
                            <div><h4 class="font-black text-xl tracking-tighter">${m.name}</h4><p class="text-[10px] text-white/20 font-bold mt-1 tracking-tight">${m.phone}</p></div>
                        </div>
                        <div class="text-right"><p class="text-[8px] font-black text-amber-500 uppercase italic mb-1">Cumulative</p><p class="font-black text-lg tracking-tight">${(m.totalPaid || 0).toLocaleString()}Ïõê</p></div>
                    </div>
                    <div class="grid grid-cols-4 gap-3 bg-black/40 p-4 rounded-2xl text-[10px] font-black border border-white/5">
                        <div class="text-center border-r border-white/5"><p class="text-[7px] text-white/20 mb-1">BIRTH</p>${m.birth ? m.birth.slice(5) : '-'}</div>
                        <div class="text-center border-r border-white/5"><p class="text-[7px] text-white/20 mb-1">HEIGHT</p>${m.height || '-'}</div>
                        <div class="text-center border-r border-white/5"><p class="text-[7px] text-white/20 mb-1">SHOE</p>${m.shoe || '-'}</div>
                        <div class="text-center"><p class="text-[7px] text-white/20 mb-1">SIZE</p>${m.cloth || '-'}</div>
                    </div>
                </div>`).join('');

            const hGen = (items) => items.map(h => `
                <div onclick="${isAdmin ? `openLedger('${h.amt > 0 ? 'INCOME' : 'EXPENSE'}', ${h.id})` : ''}" class="flex justify-between items-center p-5 card border-white/5 transition-all active:scale-95">
                    <div><p class="font-bold text-sm tracking-tight">${h.cat} ${h.name ? `<span class="text-white/20 text-[10px] ml-1">| ${h.name}</span>` : ''}</p><p class="text-[9px] text-white/10 font-bold italic mt-1">${h.date}</p></div>
                    <span class="font-black text-base ${h.amt > 0 ? 'text-amber-400' : 'text-white'}">${h.amt.toLocaleString()}Ïõê</span>
                </div>`).join('');
            document.getElementById('homeHistory').innerHTML = hGen(db.history.slice(0, 5));
            document.getElementById('fullHistory').innerHTML = hGen(db.history);
            if(document.getElementById('ledgerTab').classList.contains('active')) setTimeout(drawChart, 10);
        };

        const drawChart = () => {
            const ctx = document.getElementById('mainChart').getContext('2d');
            if(chart) chart.destroy();
            let b = 0; let d = [...db.history].reverse(); let p = d.map(h => { b += h.amt; return b; });
            chart = new Chart(ctx, { type: 'line', data: { labels: d.map(h => h.date.slice(5)), datasets: [{ data: p, borderColor: '#fbbf24', borderWidth: 4, tension: 0.4, pointRadius: 0, fill: true, backgroundColor: 'rgba(251, 191, 36, 0.03)' }] }, options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: 'rgba(255,255,255,0.2)', font: { size: 9, weight: '800' } } } } } });
        };

        const switchTab = (t) => {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => { b.classList.remove('active'); b.classList.add('text-white/20'); });
            document.getElementById(t + 'Tab').classList.add('active');
            document.getElementById('btn-' + t).classList.add('active');
            document.getElementById('btn-' + t).classList.remove('text-white/20');
            render();
        };

        const openModal = (id) => { document.getElementById(id).classList.remove('hidden'); document.body.style.overflow = 'hidden'; };
        const closeModal = (id) => { document.getElementById(id).classList.add('hidden'); document.body.style.overflow = 'auto'; };
        
        const submitJoin = () => {
            const m = { id: Date.now(), name: document.getElementById('mName').value.trim(), phone: document.getElementById('mPhone').value.trim(), birth: document.getElementById('mBirth').value, height: document.getElementById('mHeight').value, shoe: document.getElementById('mShoe').value, cloth: document.getElementById('mCloth').value, photo: tempPhoto, totalPaid: 0 };
            if(!m.name || !m.phone) return alert("ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÏã≠ÏãúÏò§.");
            db.pending.push(m); sync(); closeModal('joinModal'); alert("Í∞ÄÏûÖ Ïã†Ï≤≠Ïù¥ Ï†ïÏÉÅÏ†ÅÏúºÎ°ú Ï†ëÏàòÎêòÏóàÏäµÎãàÎã§."); tempPhoto = "";
        };

        const approve = (id) => { const i = db.pending.findIndex(x => x.id === id); db.members.push(db.pending[i]); db.pending.splice(i, 1); sync(); };
        const exportData = () => { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(db)], {type:'application/json'})); a.download='chongmu_master_backup.json'; a.click(); };

        render();
    </script>
</body>
</html>